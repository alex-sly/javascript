(()=>{"use strict";const e=e=>{const t=document.getElementById("table-body");t.innerHTML="",e.forEach((e=>{t.insertAdjacentHTML("beforeend",`\n      <tr data-key=${e.id}>\n        <th scope="row">${e.id}</th>\n        <td>${e.name}</td>\n        <td>${e.email}</td>\n        <td>${e.children?"Есть":"Нет"}</td>\n        <td>\n          <div class="form-check form-switch">\n            <input class="form-check-input" type="checkbox" role="switch"\n              id="form-children" ${e.permissions?"checked":""}>\n          </div>\n        </td>\n        <td>\n          <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">\n            <button type="button" class="btn btn-warning btn-edit">\n              <i class="bi-pencil-square"></i>\n            </button>\n            <button type="button" class="btn btn-danger btn-remove">\n              <i class="bi-person-x"></i>\n            </button>\n          </div>\n        </td>\n      </tr>\n      `)}))},t=(e,t="",s="")=>{let r=e;t?r=e+"/"+t:s&&(r=e+"?"+s);try{return fetch(r).then((e=>e.json()))}catch(e){throw new Error("Произошла ошибка, данных нет!")}},s=(e,t="",s="",r="")=>{let n=e,c={};r&&(n=e+"/"+r),t?(c={method:t},s&&(c.body=JSON.stringify(s),c.headers={"Content-Type":"application/json"})):s&&(n=e+s);try{return fetch(n,c).then((e=>e.json()))}catch(e){throw new Error("Произошла ошибка, данных нет!")}};window.userService=new class{getUsers(){return t("http://localhost:4545/users")}addUser(e){s("http://localhost:4545/users","POST",e)}removeUser(e){s("http://localhost:4545/users","DELETE","",e)}changeUser(e,t){s("http://localhost:4545/users","PATCH",t,e)}getUser(e){return t("http://localhost:4545/users",e)}editUser(e,t){s("http://localhost:4545/users","PUT",t,e)}filterUsers(e){return t("http://localhost:4545/users","",e+"=true")}getSortUsers(e){return t("http://localhost:4545/users","",`_sort=${e.name}&_order=${e.value}`)}getSearchUsers(e){return t("http://localhost:4545/users","","name_like="+e)}},userService.getUsers().then((t=>{e(t)})),(()=>{const t=document.querySelector("form"),s=t.querySelector("#form-name"),r=t.querySelector("#form-email"),n=t.querySelector("#form-children");t.addEventListener("submit",(c=>{if(c.preventDefault(),!t.dataset.method){const c={name:s.value,email:r.value,children:n.checked,permissions:!1};userService.addUser(c).then((()=>{userService.getUsers().then((s=>{e(s),t.reset()})).catch((e=>{console.log(e.message)}))})).catch((e=>{console.log(e.message)}))}}))})(),document.getElementById("table-body").addEventListener("click",(t=>{if(t.target.closest(".btn-remove")){const s=t.target.closest("tr").dataset.key;userService.removeUser(s).then((()=>{userService.getUsers().then((t=>{e(t)})).catch((e=>{console.log(e.message)}))})).catch((e=>{console.log(e.message)}))}})),document.getElementById("table-body").addEventListener("click",(t=>{if(t.target.closest("input[type=checkbox")){const s=t.target.closest("tr"),r=s.querySelector("input[type=checkbox"),n=s.dataset.key;userService.changeUser(n,{permissions:r.checked}).then((()=>{userService.getUsers().then((t=>{e(t)})).catch((e=>{console.log(e.message)}))})).catch((e=>{console.log(e.message)}))}})),(()=>{const t=document.getElementById("table-body"),s=document.querySelector("form"),r=s.querySelector("#form-name"),n=s.querySelector("#form-email"),c=s.querySelector("#form-children");t.addEventListener("click",(e=>{if(e.target.closest(".btn-edit")){const t=e.target.closest("tr").dataset.key;userService.getUser(t).then((e=>{r.value=e.name,n.value=e.email,c.checked=e.children,s.dataset.method=t})).catch((e=>{console.log(e.message)}))}})),s.addEventListener("submit",(t=>{if(t.preventDefault(),s.dataset.method){const t=s.dataset.method,o={name:r.value,email:n.value,children:c.checked,permissions:!1};userService.editUser(t,o).then((()=>{userService.getUsers().then((t=>{e(t),s.reset(),s.removeAttribute("data-method")})).catch((e=>{console.log(e.message)}))})).catch((e=>{console.log(e.message)}))}}))})(),(()=>{const t=document.getElementById("btn-isChildren"),s=document.getElementById("btn-isPermissions"),r=document.getElementById("btn-isAll");t.addEventListener("click",(()=>{userService.filterUsers("children").then((t=>{e(t)})).catch((e=>{console.log(e.message)}))})),s.addEventListener("click",(()=>{userService.filterUsers("permissions").then((t=>{e(t)})).catch((e=>{console.log(e.message)}))})),r.addEventListener("click",(()=>{userService.getUsers().then((t=>{e(t)})).catch((e=>{console.log(e.message)}))}))})(),(()=>{const t=document.getElementById("sort-is-children");let s=!1;t.style.cursor="pointer",t.addEventListener("click",(()=>{userService.getSortUsers({name:"children",value:s?"asc":"desc"}).then((t=>{e(t)})).catch((e=>{console.log(e.message)})),s=!s}))})(),(()=>{const t=document.getElementById("search-input"),s=((e,t=300)=>{let s;return(...r)=>{clearTimeout(s),s=setTimeout((()=>{e.apply(void 0,r)}),t)}})((()=>{userService.getSearchUsers(t.value).then((t=>{e(t)})).catch((e=>{console.log(e.message)}))}),500);t.addEventListener("input",s)})()})();